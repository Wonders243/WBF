{% extends "staff/base_staff.html" %}
{% block staff_title %}Staff — Histoires d'éducation{% endblock %}

{% block staff_content %}
<header class="mb-4 flex items-center justify-between">
  <h1 class="text-2xl font-extrabold text-blue-700 dark:text-blue-300">Histoires d'éducation</h1>
  <a href="{% url 'staff:story_create' %}"
     class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700">
    Créer une histoire
  </a>
</header>

<form method="get" role="search" class="bg-white dark:bg-slate-900 rounded-xl shadow ring-1 ring-black/5 dark:ring-white/10 p-4 mb-4 grid grid-cols-1 md:grid-cols-5 gap-3">
  <label class="sr-only" for="q">Recherche</label>
  <input id="q" type="search" name="q" value="{{ request.GET.q|default_if_none:'' }}" placeholder="Titre, bénéficiaire…"
         class="px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-600/60 md:col-span-3">
  <select name="category" class="px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-blue-600/60">
    <option value="">Toutes catégories</option>
    <option value="education" {% if request.GET.category == 'education' %}selected{% endif %}>Éducation</option>
    <option value="sante" {% if request.GET.category == 'sante' %}selected{% endif %}>Santé</option>
    <option value="psy" {% if request.GET.category == 'psy' %}selected{% endif %}>Soutien psychologique</option>
    <option value="autre" {% if request.GET.category == 'autre' %}selected{% endif %}>Autre</option>
  </select>
  <div>
    <button class="px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700">Filtrer</button>
    {% if request.GET %}
      <a href="{{ request.path }}" class="ml-2 text-sm text-slate-600 dark:text-slate-400 hover:underline">Réinitialiser</a>
    {% endif %}
  </div>
</form>

<section class="bg-white dark:bg-slate-900 rounded-xl shadow ring-1 ring-black/5 dark:ring-white/10 overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-slate-50 dark:bg-slate-900/60 sticky top-0 z-10">
        <tr class="text-left text-slate-600 dark:text-slate-300">
          <th class="p-3 font-medium">Titre</th>
          <th class="p-3 font-medium">Bénéficiaire</th>
          <th class="p-3 font-medium">Ville</th>
          <th class="p-3 font-medium">Catégorie</th>
          <th class="p-3 font-medium">Consentement</th>
          <th class="p-3 font-medium">Publiée</th>
          <th class="p-3 font-medium">Créée</th>
          <th class="p-3 font-medium text-right">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 dark:divide-white/10">
        {% for s in page_obj.object_list %}
        <tr class="hover:bg-slate-50 dark:hover:bg-white/5 transition">
          <td class="p-3 font-medium text-slate-900 dark:text-slate-100">{{ s.title }}</td>
          <td class="p-3 text-slate-700 dark:text-slate-300">{{ s.beneficiary_name|default:"—" }}</td>
          <td class="p-3 text-slate-700 dark:text-slate-300">{{ s.city|default:"—" }}</td>
          <td class="p-3 text-slate-700 dark:text-slate-300">{{ s.get_category_display }}</td>
          <td class="p-3">
            {% if s.consent_file %}
              <span class="px-2 py-1 text-xs rounded bg-emerald-50 text-emerald-700 border border-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-900/40">OK</span>
            {% else %}
              <span class="px-2 py-1 text-xs rounded bg-slate-100 text-slate-700 border border-slate-200 dark:bg-slate-800/60 dark:text-slate-200 dark:border-slate-700">Manquant</span>
            {% endif %}
          </td>
          <td class="p-3">{% if s.is_published %}<span class="px-2 py-0.5 rounded text-xs bg-emerald-50 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300">Oui</span>{% else %}<span class="px-2 py-0.5 rounded text-xs bg-slate-100 text-slate-700 dark:bg-slate-800/60 dark:text-slate-200">Non</span>{% endif %}</td>
          <td class="p-3 text-slate-700 dark:text-slate-300">{{ s.created_at|date:"Y-m-d" }}</td>
          <td class="p-3 text-right whitespace-nowrap">
            <form method="post" action="{% url 'staff:story_toggle_published' s.id %}" class="inline">
              {% csrf_token %}
              <button class="mr-3 text-xs px-2 py-1 rounded border border-slate-300 dark:border-white/10 hover:bg-slate-50 dark:hover:bg-white/5">
                {% if s.is_published %}Dépublier{% else %}Publier{% endif %}
              </button>
            </form>
            <a href="{% url 'staff:story_update' s.id %}" class="mr-2 text-blue-600 dark:text-blue-300 hover:underline">Éditer</a>
            <a href="{% url 'staff:story_images' s.id %}" class="mr-2 text-slate-600 dark:text-slate-300 hover:underline">Images</a>
            <a href="{% url 'staff:story_delete' s.id %}" class="text-rose-600 hover:underline">Supprimer</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="p-6 text-center text-slate-500 dark:text-slate-400">Aucune histoire.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

{% include "staff/partials/_pagination.html" with page_obj=page_obj %}
{% endblock %}
