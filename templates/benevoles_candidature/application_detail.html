{% extends "base.html" %}

{% block title %}Candidature bénévole — Détails{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <header class="mb-6 flex items-start justify-between gap-4">
    <div>
      <h1 class="text-2xl md:text-3xl font-extrabold text-blue-700 dark:text-blue-300">Ma candidature</h1>
      <div class="mt-2 text-sm text-slate-600 dark:text-slate-300">Statut :
        <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-semibold
          {% if app.status == 'approved' %} bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200
          {% elif app.status == 'needs_changes' %} bg-amber-100 text-amber-800 dark:bg-amber-900/40 dark:text-amber-200
          {% elif app.status == 'rejected' %} bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200
          {% else %} bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-200 {% endif %}">
          {{ app.get_status_display }}
        </span>
      </div>
      {% if app.review_note %}
      <p class="mt-2 text-sm text-amber-700 dark:text-amber-300">Note: {{ app.review_note }}</p>
      {% endif %}
    </div>
    {% if main_image_url %}
      <img src="{{ main_image_url }}" alt="Aperçu" class="h-20 w-20 rounded-lg object-cover ring-1 ring-black/10 dark:ring-white/10">
    {% endif %}
  </header>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <section class="rounded-xl border border-slate-200 dark:border-white/10 bg-white/80 dark:bg-slate-900/50 p-4 md:p-6 shadow-sm">
      <h2 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Informations</h2>
      {% if allow_edit %}
        <form method="post" class="space-y-4">
          {% csrf_token %}
          <input type="hidden" name="action" value="update_infos">
          {{ edit_form.non_field_errors }}
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">{{ edit_form.full_name.label_tag }} {{ edit_form.full_name }}</div>
            <div>{{ edit_form.phone.label_tag }} {{ edit_form.phone }}</div>
            <div>{{ edit_form.birth_date.label_tag }} {{ edit_form.birth_date }}</div>
            <div class="md:col-span-2">{{ edit_form.address_line1.label_tag }} {{ edit_form.address_line1 }}</div>
            <div class="md:col-span-2">{{ edit_form.address_line2.label_tag }} {{ edit_form.address_line2 }}</div>
            <div>{{ edit_form.postal_code.label_tag }} {{ edit_form.postal_code }}</div>
            <div>{{ edit_form.city.label_tag }} {{ edit_form.city }}</div>
            <div>{{ edit_form.state.label_tag }} {{ edit_form.state }}</div>
            <div>{{ edit_form.country.label_tag }} {{ edit_form.country }}</div>
            <div class="md:col-span-2">{{ edit_form.emergency_contact.label_tag }} {{ edit_form.emergency_contact }}</div>
            <div class="md:col-span-2">{{ edit_form.id_type.label_tag }} {{ edit_form.id_type }}</div>
            <div class="md:col-span-1">{{ edit_form.id_number.label_tag }} {{ edit_form.id_number }}</div>
            <div class="md:col-span-1">{{ edit_form.id_expiry.label_tag }} {{ edit_form.id_expiry }}</div>
            <div class="md:col-span-2">{{ edit_form.motivation.label_tag }} {{ edit_form.motivation }}</div>
          </div>

          <div class="flex items-center justify-end">
            <button type="submit" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700">Mettre à jour</button>
          </div>
        </form>
      {% else %}
        <p class="text-sm text-slate-600 dark:text-slate-300">Vos informations ne sont plus modifiables à ce stade.</p>
      {% endif %}
    </section>

    <section class="rounded-xl border border-slate-200 dark:border-white/10 bg-white/80 dark:bg-slate-900/50 p-4 md:p-6 shadow-sm">
      <h2 class="text-lg font-semibold mb-4 text-slate-900 dark:text-white">Documents transmis</h2>

      {% if docs %}
        <ul class="space-y-2 mb-4">
          {% for d in docs %}
            <li class="flex items-center justify-between gap-3 rounded-lg border border-slate-200 dark:border-white/10 p-2">
              <div>
                <div class="text-sm font-medium">{{ d.get_doc_type_display }}</div>
                <div class="text-xs text-slate-500">{{ d.uploaded_at|date:"d/m/Y H:i" }}</div>
              </div>
              <div class="text-xs">
                <span class="inline-flex px-2 py-0.5 rounded-full font-semibold
                  {% if d.status == 'approved' %} bg-emerald-100 text-emerald-800 dark:bg-emerald-900/40 dark:text-emerald-200
                  {% elif d.status == 'rejected' %} bg-red-100 text-red-800 dark:bg-red-900/40 dark:text-red-200
                  {% else %} bg-blue-100 text-blue-800 dark:bg-blue-900/40 dark:text-blue-200 {% endif %}">
                  {{ d.get_status_display }}
                </span>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-sm text-slate-600 dark:text-slate-300 mb-4">Aucun document pour le moment.</p>
      {% endif %}

      {% if allow_add %}
        <form method="post" enctype="multipart/form-data" class="space-y-3">
          {% csrf_token %}
          <input type="hidden" name="action" value="add_docs">
          {{ formset.management_form }}
          {% for f in formset.forms %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 items-end">
              <div>{{ f.doc_type.label_tag }} {{ f.doc_type }}</div>
              <div class="md:col-span-2">{{ f.file.label_tag }} {{ f.file }}</div>
            </div>
          {% endfor %}
          <div class="flex items-center justify-end">
            <button type="submit" class="px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700">Ajouter</button>
          </div>
        </form>
      {% else %}
        <p class="text-sm text-slate-600 dark:text-slate-300">L’ajout de documents est verrouillé.</p>
      {% endif %}
    </section>
  </div>

  <div class="mt-6 flex items-center justify-end">
    <a href="{% url 'benevoles:dashboard' %}" class="px-4 py-2 rounded-lg bg-slate-100 dark:bg-white/10 hover:bg-slate-200 dark:hover:bg-white/20">Retour au tableau de bord</a>
  </div>
</div>
{% endblock %}

