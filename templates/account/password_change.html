{% extends "account/base.html" %}
{% load widget_tweaks %}

{% block title %}Changer le mot de passe{% endblock %}

{% block auth_heading %}
  <h1 id="page-title" class="text-2xl sm:text-3xl font-extrabold tracking-tight text-blue-700 dark:text-blue-300 text-center">
    Changer mon mot de passe
  </h1>
  <p class="mt-1 text-sm text-slate-600 dark:text-slate-300/80 text-center">
    Saisissez votre mot de passe actuel puis le nouveau.
  </p>
{% endblock %}

{% block account_content %}
  {% if form.non_field_errors %}
    <div class="mb-4 text-sm rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-red-700 dark:bg-red-950/40 dark:text-red-200 dark:border-red-900/40 text-center">
      {{ form.non_field_errors }}
    </div>
  {% endif %}

  <form method="post" novalidate class="space-y-4">
    {% csrf_token %}

    <div class="relative">
      <label for="id_oldpassword" class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200">Mot de passe actuel</label>
      <div class="relative">
        {{ form.oldpassword|add_class:"w-full rounded-xl border border-slate-300 bg-white/80 px-3 py-2.5 pr-12 shadow-sm outline-none transition focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:bg-white/10 dark:border-white/10 dark:focus:ring-blue-500/20"|attr:"autocomplete:current-password" }}
        <button type="button" class="absolute right-2.5 top-1/2 -translate-y-1/2 inline-flex items-center rounded-lg px-2 py-1 text-xs font-medium text-slate-600 hover:text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60 dark:text-slate-300" data-toggle="id_oldpassword">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/>
          </svg>
          <span class="sr-only">Afficher/masquer le mot de passe</span>
        </button>
      </div>
      {% if form.oldpassword.errors %}
        <p class="mt-1 text-sm text-red-600 dark:text-red-300">{{ form.oldpassword.errors|striptags }}</p>
      {% endif %}
    </div>

    <div class="relative">
      <label for="id_password1" class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200">Nouveau mot de passe</label>
      <div class="relative">
        {{ form.password1|add_class:"w-full rounded-xl border border-slate-300 bg-white/80 px-3 py-2.5 pr-12 shadow-sm outline-none transition focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:bg-white/10 dark:border-white/10 dark:focus:ring-blue-500/20"|attr:"autocomplete:new-password" }}
        <button type="button" class="absolute right-2.5 top-1/2 -translate-y-1/2 inline-flex items-center rounded-lg px-2 py-1 text-xs font-medium text-slate-600 hover:text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60 dark:text-slate-300" data-toggle="id_password1">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/>
          </svg>
          <span class="sr-only">Afficher/masquer le mot de passe</span>
        </button>
      </div>
      {% if form.password1.errors %}
        <p class="mt-1 text-sm text-red-600 dark:text-red-300">{{ form.password1.errors|striptags }}</p>
      {% endif %}
    </div>

    <div class="relative">
      <label for="id_password2" class="mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200">Confirmer le nouveau mot de passe</label>
      <div class="relative">
        {{ form.password2|add_class:"w-full rounded-xl border border-slate-300 bg-white/80 px-3 py-2.5 pr-12 shadow-sm outline-none transition focus:border-blue-500 focus:ring-4 focus:ring-blue-100 dark:bg-white/10 dark:border-white/10 dark:focus:ring-blue-500/20"|attr:"autocomplete:new-password" }}
        <button type="button" class="absolute right-2.5 top-1/2 -translate-y-1/2 inline-flex items-center rounded-lg px-2 py-1 text-xs font-medium text-slate-600 hover:text-slate-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60 dark:text-slate-300" data-toggle="id_password2">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" aria-hidden="true">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8Z"/><circle cx="12" cy="12" r="3"/>
          </svg>
          <span class="sr-only">Afficher/masquer le mot de passe</span>
        </button>
      </div>
      {% if form.password2.errors %}
        <p class="mt-1 text-sm text-red-600 dark:text-red-300">{{ form.password2.errors|striptags }}</p>
      {% endif %}
    </div>

    <button type="submit" class="w-full inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2.5 font-semibold text-white shadow hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60">
      Mettre Ã  jour
    </button>
  </form>
{% endblock %}

{% block scripts %}
  <script>
    document.querySelectorAll('[data-toggle]').forEach(function(btn){
      btn.addEventListener('click', function(){
        var id = btn.getAttribute('data-toggle');
        var input = document.getElementById(id);
        if(!input) return;
        var isPwd = input.getAttribute('type') === 'password';
        input.setAttribute('type', isPwd ? 'text' : 'password');
      });
    });
  </script>
{% endblock %}
