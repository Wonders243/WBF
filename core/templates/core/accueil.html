{% extends 'base.html' %}
{% load static %}
{% load user_extras %}

{% is_volunteer as user_is_volunteer %}

{% block title %}Accueil ‚Äî BAMU WELLBEING Foundation{% endblock %}

{% block content %}

{# ==========================================================
   HERO ‚Äî Mobile-first (image visible) + animations
   - Mobile: image stacked on top, text card below (no overlap)
   - Desktop (‚â• lg): split layout 2 cols (image | text)
   - Subtle, motion-safe animations; reduced-motion friendly
   ========================================================== #}
<section id="hero" class="relative overflow-hidden bg-gradient-to-b from-blue-50/60 to-transparent dark:from-slate-800/40">
  <div class="container mx-auto px-4 py-8 lg:py-16 grid grid-cols-1 lg:grid-cols-12 gap-6 items-center">
    {# Image #}
    <div class="order-1 lg:order-2 lg:col-span-6">
      <picture>
        <source media="(min-width:1024px)" srcset="{% static 'img/cover-hero-21x9-textsafe.webp' %}">
        <source media="(min-width:640px)"  srcset="{% static 'img/cover-hero-16x9.webp' %}">
        <img
          src="{% static 'img/cover-mobile-4x5.webp' %}"
          alt="Responsable de la fondation souriante entour√©e d‚Äôenfants ‚Äî mission psycho-sociale"
          class="w-full h-64 sm:h-80 lg:h-[72vh] object-cover rounded-2xl shadow-xl ring-1 ring-black/5 dark:ring-white/10 sr-animate"
          loading="eager" fetchpriority="high" decoding="async">
      </picture>
    </div>

    {# Texte #}
    <div class="order-2 lg:order-1 lg:col-span-6">
      <div class="bg-white/90 dark:bg-slate-900/80 backdrop-blur supports-[backdrop-filter]:bg-white/70 supports-[backdrop-filter]:dark:bg-slate-900/60 ring-1 ring-black/5 dark:ring-white/10 rounded-2xl p-6 sm:p-8 shadow-lg in-pop motion-reduce:animate-none">
        <p class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-blue-700/80 dark:text-blue-300/90 mb-2">
          <span class="h-1.5 w-1.5 rounded-full bg-blue-600/70"></span> Sant√© mentale ‚Ä¢ Inclusion sociale
        </p>
        <h1 class="text-slate-900 dark:text-white text-3xl sm:text-4xl lg:text-5xl font-extrabold leading-tight">
          Bamu Wellbeing Foundation
        </h1>
        <h2 class="mt-2 text-lg sm:text-xl font-bold text-slate-700 dark:text-slate-200">
          Ton bien‚Äë√™tre, notre priorit√©
        </h2>
        <p class="mt-4 text-slate-700/90 dark:text-slate-300 text-base sm:text-lg">
          Port√©e par des experts en sant√© mentale et en insertion, la BWF accompagne les personnes vuln√©rables
          avec <span class="font-semibold">transparence</span>, <span class="font-semibold">professionnalisme</span> et <span class="font-semibold">impact mesurable</span>.
        </p>
        <div class="mt-6 flex flex-col sm:flex-row gap-3 sm:gap-4 sm:items-center">
          <a href="{% url 'core:nous' %}"
             class="inline-flex items-center justify-center gap-2 rounded-xl bg-blue-600 text-white font-semibold px-6 py-3 shadow hover:shadow-md hover:-translate-y-[2px] active:translate-y-[0px] transition transform focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-300">
            Qui sommes‚Äënous ?
          </a>
          <a href="#actions"
             class="inline-flex items-center justify-center gap-2 rounded-xl px-6 py-3 font-semibold text-blue-700 dark:text-blue-300 ring-1 ring-blue-200/70 dark:ring-white/15 hover:bg-blue-50/70 dark:hover:bg-white/5 hover:-translate-y-[1px] transition transform">
            Nos actions
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

{% include "partials/news_carousel.html" %}

{# ==========================================================
   √âV√âNEMENTS + ENGAGEMENTS ‚Äî cartes douces, a11y, animations
   ========================================================== #}
<section class="py-12 bg-slate-50 dark:bg-slate-950">
  <div class="container mx-auto px-4">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">

      {# ‚óÄ‚îÄ‚îÄ Carrousel d‚Äô√©v√©nements ‚îÄ‚îÄ‚ñ∂ #}
      <div class="relative bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 overflow-hidden">
        <div class="flex items-baseline justify-between gap-4 mb-4">
          <h2 class="text-2xl font-semibold text-blue-700 dark:text-blue-300">√âv√©nements √† venir</h2>
          {% if upcoming_events %}
            <span class="inline-flex items-center rounded-full bg-blue-50 text-blue-700 px-2.5 py-1 text-xs font-semibold dark:bg-blue-950/50 dark:text-blue-300">
              {{ upcoming_events|length }} √©v√®nements
            </span>
          {% endif %}
        </div>

        <div id="events-carousel"
             class="relative overflow-hidden h-[66vw] sm:h-[54vw] md:h-80 lg:h-96"
             role="region"
             aria-roledescription="carousel"
             aria-label="Carrousel des √©v√©nements √† venir">
          <p id="ec-status" class="sr-only" aria-live="polite" aria-atomic="true"></p>

          {% for ev in upcoming_events %}
            <div class="ec-slide absolute inset-0 transition-opacity duration-700 ease-in-out flex flex-col {% if forloop.first %}opacity-100{% else %}opacity-0{% endif %}"
                 role="group" aria-roledescription="slide" aria-label="{{ forloop.counter }} / {{ upcoming_events|length }}">
              <a href="{% url 'core:event_detail' ev.slug %}" class="w-full h-full flex items-center justify-center bg-slate-50 dark:bg-slate-800/50">
                {% if ev.image %}
                  <img
                    src="{{ ev.image.url }}"
                    alt="{{ ev.title }}"
                    class="max-h-full max-w-full object-contain"
                    {% if forloop.first %}loading="eager" fetchpriority="high"{% else %}loading="lazy"{% endif %}
                    decoding="async">
                {% else %}
                  <div class="text-slate-400 text-sm">Aucune image</div>
                {% endif %}
              </a>

              <div class="pointer-events-none absolute bottom-0 left-0 right-0">
                <div class="h-16 bg-gradient-to-t from-white via-white/95 to-white/60 dark:from-slate-900 dark:via-slate-900/90 dark:to-slate-900/60"></div>
                <div class="bg-white/90 dark:bg-slate-900/80 backdrop-blur px-4 py-3 ring-1 ring-black/5 dark:ring-white/10">
                  <h3 class="text-lg md:text-xl font-semibold text-blue-700 dark:text-blue-300 leading-tight">
                    {{ ev.title }}
                  </h3>
                  <p class="text-slate-600 dark:text-slate-400 text-sm flex items-center gap-2">
                    <span class="inline-flex items-center rounded-full bg-slate-100 dark:bg-slate-800 px-2 py-0.5">üìÖ {{ ev.date|date:"d M Y" }}</span>
                    {% if ev.lieu %}<span class="hidden sm:inline">‚Ä¢ {{ ev.lieu }}</span>{% endif %}
                  </p>
                  {% if ev.description %}
                    <p class="text-slate-700 dark:text-slate-300 text-sm mt-1 line-clamp-3">
                      {{ ev.description }}
                    </p>
                  {% endif %}
                </div>
              </div>
            </div>
          {% empty %}
            <div class="flex items-center justify-center h-full text-slate-500 dark:text-slate-400">
              Aucun √©v√©nement √† venir pour le moment.
            </div>
          {% endfor %}
        </div>

        <div class="pointer-events-none absolute inset-0 flex items-center justify-between px-2">
          <button id="events-prev"
                  class="pointer-events-auto bg-white/80 dark:bg-slate-900/70 hover:bg-white dark:hover:bg-slate-800 p-2 rounded-full shadow ring-1 ring-black/10 dark:ring-white/10"
                  aria-controls="events-carousel" aria-label="Diapo pr√©c√©dente">‚Äπ</button>
          <button id="events-next"
                  class="pointer-events-auto bg-white/80 dark:bg-slate-900/70 hover:bg-white dark:hover:bg-slate-800 p-2 rounded-full shadow ring-1 ring-black/10 dark:ring-white/10"
                  aria-controls="events-carousel" aria-label="Diapo suivante">‚Ä∫</button>
        </div>

        {% if upcoming_events|length > 1 %}
        <div class="mt-4 flex items-center justify-center gap-2">
          {% for ev in upcoming_events %}
            <button type="button"
                    class="ec-dot h-2.5 w-2.5 rounded-full bg-slate-300 dark:bg-slate-600 aria-selected:bg-blue-600 aria-selected:dark:bg-blue-400"
                    role="tab"
                    aria-controls="events-carousel"
                    aria-label="Aller √† la diapo {{ forloop.counter }}"
                    aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
                    data-index="{{ forloop.counter0 }}"></button>
          {% endfor %}
        </div>
        {% endif %}
      </div>

      {# ‚ñ∂‚îÄ‚îÄ Nos Engagements ‚îÄ‚îÄ‚ñ∂ #}
      <div class="grid grid-cols-1 gap-6">
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 text-center transition hover:shadow-lg hover:-translate-y-[2px] sr-animate">
          <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-3 animate-float motion-reduce:animate-none">üîç</div>
          <h3 class="text-2xl font-semibold text-blue-700 dark:text-blue-300 mb-1">Transparence</h3>
          <p class="text-slate-600 dark:text-slate-300">Gestion claire et rapports publics pour un suivi en confiance.</p>
        </div>
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 text-center transition hover:shadow-lg hover:-translate-y-[2px] sr-animate">
          <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-3 animate-float motion-reduce:animate-none" style="animation-delay:.1s">üß†</div>
          <h3 class="text-2xl font-semibold text-blue-700 dark:text-blue-300 mb-1">Expertise</h3>
          <p class="text-slate-600 dark:text-slate-300">Psychologues, √©ducateurs, travailleurs sociaux engag√©s.</p>
        </div>
        <div class="bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 text-center transition hover:shadow-lg hover:-translate-y-[2px] sr-animate">
          <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-3 animate-float motion-reduce:animate-none" style="animation-delay:.2s">‚ú®</div>
          <h3 class="text-2xl font-semibold text-blue-700 dark:text-blue-300 mb-1">Impact</h3>
          <p class="text-slate-600 dark:text-slate-300">+10‚ÄØ000 personnes accompagn√©es chaque ann√©e gr√¢ce √† vous.</p>
        </div>
      </div>

    </div>
  </div>

  {# Scripts ‚Äî carrousel + scroll reveal #}
  <script>
    // --- √âv√©nements Carousel (a11y + reduced motion) ---
    document.addEventListener('DOMContentLoaded', () => {
      // Enable progressive-enhancement animations only when JS is active
      document.documentElement.classList.add('js');
      const root = document.getElementById('events-carousel');
      const slides = root ? Array.from(root.querySelectorAll('.ec-slide')) : [];
      const dots = Array.from(document.querySelectorAll('.ec-dot'));
      const total = slides.length;
      const status = document.getElementById('ec-status');
      let current = 0, timer = null, paused = false;
      const btnNext = document.getElementById('events-next');
      const btnPrev = document.getElementById('events-prev');
      const prefersReduced = window.matchMedia?.('(prefers-reduced-motion: reduce)').matches;

      function announce(){ if(status) status.textContent = `Diapo ${current+1} sur ${total}`; }
      function reflectDots(){ dots.forEach((d,i)=> d.setAttribute('aria-selected', String(i===current))); }
      function show(i){ if(!total) return; slides.forEach((s,idx)=>{ s.style.opacity = (idx===i)?'1':'0'; s.setAttribute('aria-hidden', String(idx!==i)); }); current=i; reflectDots(); announce(); }
      function next(){ show((current+1)%total); }
      function prev(){ show((current-1+total)%total); }
      function start(){ if(prefersReduced || total<=1) return; stop(); timer = setInterval(next, 5000); }
      function stop(){ if(timer){ clearInterval(timer); timer=null; } }

      if(total>0){ show(0); }
      if(total>1){
        btnNext?.addEventListener('click', ()=>{ next(); start(); });
        btnPrev?.addEventListener('click', ()=>{ prev(); start(); });
        dots.forEach(d => d.addEventListener('click', ()=>{ const i = Number(d.dataset.index)||0; show(i); start(); }));
        [btnNext, btnPrev].forEach(b=> b?.addEventListener('keydown', (e)=>{
          if(e.key==='ArrowRight'){ next(); start(); }
          if(e.key==='ArrowLeft'){ prev(); start(); }
          if(e.key==='Home'){ show(0); start(); }
          if(e.key==='End'){ show(total-1); start(); }
        }));
        root?.addEventListener('mouseenter', ()=>{ paused=true; stop(); });
        root?.addEventListener('mouseleave', ()=>{ paused=false; start(); });
        document.addEventListener('visibilitychange', ()=>{ if(document.hidden) stop(); else if(!paused) start(); });
        start();
      } else {
        btnNext?.classList.add('hidden');
        btnPrev?.classList.add('hidden');
      }

      // --- Scroll reveal (motion-safe) ---
      const els = document.querySelectorAll('.sr-animate');
      if('IntersectionObserver' in window){
        const io = new IntersectionObserver((entries)=>{
          entries.forEach(entry=>{
            if(entry.isIntersecting){ entry.target.classList.add('is-visible'); io.unobserve(entry.target); }
          });
        }, { rootMargin: '0px 0px -10% 0px', threshold: .1 });
        els.forEach(el=> io.observe(el));
      } else {
        els.forEach(el=> el.classList.add('is-visible'));
      }
    });
  </script>

  {# Animations utilitaires ‚Äî r√©duites si prefers-reduced-motion #}
  <style>
    /* Progressive enhancement: visible by default; animate only when JS adds .js on <html> */
    .sr-animate{ opacity:1; transform:none; }
    .js .sr-animate{ opacity:0; transform: translateY(8px); transition: opacity .6s ease, transform .6s ease; }
    .js .sr-animate.is-visible{ opacity:1; transform:none; }
    @media (prefers-reduced-motion: reduce){
      .js .sr-animate{ opacity:1 !important; transform:none !important; transition:none !important; }
    }
    @keyframes popIn{ from{ opacity:0; transform: translateY(10px) scale(.98)} to{ opacity:1; transform:none } }
    .in-pop{ animation: popIn .55s both .05s; }
    @keyframes floatSlow{ 0%,100%{ transform: translateY(0) } 50%{ transform: translateY(-4px) } }
    .animate-float{ animation: floatSlow 4s ease-in-out infinite; }
  </style>
</section>

{# ==========================================================
   Actions cl√©s ‚Äî tonalit√© bien‚Äë√™tre / insertion
   ========================================================== #}
<section id="actions" class="py-12 bg-white dark:bg-slate-900">
  <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">

    <div class="group bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 hover:shadow-xl transition flex flex-col sr-animate">
      <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4">üì¶</div>
      <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Projets</h3>
      <p class="mt-2 text-slate-600 dark:text-slate-300">Programmes d‚Äôaccompagnement, ateliers bien‚Äë√™tre, formations‚Ä¶</p>
      <a href="{% url 'core:project' %}" class="mt-4 inline-flex items-center gap-2 text-blue-700 dark:text-blue-300 hover:underline">D√©couvrir</a>
    </div>

    <div class="group bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 hover:shadow-xl transition flex flex-col sr-animate">
      <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4">üìÖ</div>
      <h3 class="text-xl font-semibold text-slate-900 dark:text-white">√âv√©nements</h3>
      <p class="mt-2 text-slate-600 dark:text-slate-300">Conf√©rences, journ√©es solidarit√© et ateliers interactifs.</p>
      <a href="{% url 'core:events_list' %}" class="mt-4 inline-flex items-center gap-2 text-blue-700 dark:text-blue-300 hover:underline">Voir les √©v√©nements</a>
    </div>

    {% if not user_is_volunteer %}
      <div class="group bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 hover:shadow-xl transition flex flex-col sr-animate">
        <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4">ü§ù</div>
        <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Devenir b√©n√©vole</h3>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Rejoignez‚Äënous sur le terrain et faites entendre votre c≈ìur.</p>
        {% if request.user.is_authenticated %}
          {% with open_app=request.user.volunteer_applications.all|first %}
            {% if open_app %}
              {% with s=open_app.status %}
                {% if s == 'pending' or s == 'needs_changes' %}
                  <a href="{% url 'benevoles:application_detail' open_app.pk %}"
                     class="mt-4 inline-flex items-center justify-center rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition">
                    {% if s == 'needs_changes' %}Compl√©ter ma candidature{% else %}Voir ma candidature{% endif %}
                  </a>
                  <span class="mt-3 inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium {% if s == 'pending' %}bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-200{% else %}bg-rose-100 text-rose-800 dark:bg-rose-900/30 dark:text-rose-200{% endif %}">
                    Statut : {{ open_app.get_status_display }}
                  </span>
                {% elif s == 'rejected' %}
                  <a href="{% url 'staff:application_start' %}"
                     class="mt-4 inline-flex items-center justify-center rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition">
                    Refaire une demande
                  </a>
                {% else %}
                  <a href="{% url 'benevoles:dashboard' %}"
                     class="mt-4 inline-flex items-center justify-center rounded-lg bg-slate-200 text-slate-800 px-4 py-2 hover:bg-slate-300 dark:bg-slate-800 dark:text-slate-100 transition">
                    Espace b√©n√©vole
                  </a>
                {% endif %}
              {% endwith %}
            {% else %}
              <a href="{% url 'staff:application_start' %}"
                 class="mt-4 inline-flex items-center justify-center rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition">
                Commencer ma candidature
              </a>
            {% endif %}
          {% endwith %}
        {% else %}
          {% url 'staff:application_start' as start_url %}
          <a href="{% url 'account_login' %}?next={{ start_url }}"
             class="mt-4 inline-flex items-center justify-center rounded-lg bg-blue-600 text-white px-4 py-2 hover:bg-blue-700 transition">
            Commencer ma candidature
          </a>
        {% endif %}
      </div>
    {% else %}
      <div class="group bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 hover:shadow-xl transition flex flex-col sr-animate">
        <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4">üß≠</div>
        <h3 class="text-xl font-semibold text-slate-900 dark:text-white">
          {% if request.user.first_name %}Bonjour {{ request.user.first_name }} üëã{% else %}Espace b√©n√©vole{% endif %}
        </h3>
        <p class="mt-2 text-slate-600 dark:text-slate-300">Acc√®s rapide √† vos missions et documents.</p>
        <div class="mt-4 flex flex-wrap gap-2">
          <a href="{% url 'benevoles:dashboard' %}" class="rounded-full px-3 py-1 text-sm ring-1 ring-blue-200/70 dark:ring-white/10 hover:bg-blue-50 dark:hover:bg-white/5">Mon espace</a>
          <a href="{% url 'benevoles:missions_browse' %}" class="rounded-full px-3 py-1 text-sm ring-1 ring-blue-200/70 dark:ring-white/10 hover:bg-blue-50 dark:hover:bg-white/5">Missions</a>
          <a href="{% url 'benevoles:UserDocuments_list' %}" class="rounded-full px-3 py-1 text-sm ring-1 ring-blue-200/70 dark:ring-white/10 hover:bg-blue-50 dark:hover:bg-white/5">Documents</a>
        </div>
        {% if request.user.volunteer_profile and request.user.volunteer_profile.missing_documents %}
          <div class="mt-4 rounded-lg bg-amber-50 dark:bg-amber-900/20 text-amber-900 dark:text-amber-200 p-3 text-xs">
            ‚ö†Ô∏è Documents manquants : {{ request.user.volunteer_profile.missing_documents|join:", " }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <div class="group bg-white dark:bg-slate-900 p-6 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 hover:shadow-xl transition flex flex-col sr-animate">
      <div class="h-12 w-12 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center mb-4">üíô</div>
      <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Faire un don</h3>
      <p class="mt-2 text-slate-600 dark:text-slate-300">Votre g√©n√©rosit√© finance directement nos actions.</p>
      <a href="{% url 'core:coming_soon' %}" class="mt-4 inline-flex items-center gap-2 text-blue-700 dark:text-blue-300 hover:underline">Donner maintenant</a>
    </div>

  </div>
</section>

{# ==========================================================
   CTA ‚Äî call to action final
   ========================================================== #}
<section class="bg-blue-600 dark:bg-blue-500 text-white py-16">
  <div class="container mx-auto px-4 text-center sr-animate">
    <h2 class="text-3xl font-bold mb-4 drop-shadow-sm">Ensemble, transformons des vies</h2>
    <p class="mb-6 text-lg text-blue-50">Chaque contribution compte. Participez √† notre mission et devenez acteur du changement.</p>
    <a href="{% url 'core:coming_soon' %}"
       class="inline-flex items-center justify-center gap-2 rounded-xl bg-white text-blue-600 font-semibold py-3 px-8 shadow hover:shadow-md hover:-translate-y-[2px] active:translate-y-0 transition transform focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-white/70">
      Agir d√®s aujourd‚Äôhui
    </a>
  </div>
</section>

{% endblock %}
