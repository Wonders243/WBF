{% extends "base.html" %}
{% load static %}

{% block title %}Mes notifications - BAMU WELLBEING Foundation{% endblock %}

{% block content %}
<section class="max-w-5xl mx-auto space-y-6">
  <header class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
    <div>
      <h1 class="text-2xl md:text-3xl font-extrabold text-blue-700">Notifications</h1>
      {% with current=show|default:"all" %}
      <p class="text-gray-600">
        {% if current == "unread" %}
          Vous voyez uniquement les non lues.
        {% else %}
          Toutes vos notifications.
        {% endif %}
      </p>
    </div>

    <div class="flex items-center gap-2">
      <a href="{% url 'benevoles:notifications' %}?show=unread"
         class="px-3 py-2 rounded-lg border {% if current == 'unread' %}bg-blue-50 text-blue-700 border-blue-200{% else %}hover:bg-gray-50{% endif %}">
        Non lues
      </a>
      <a href="{% url 'benevoles:notifications' %}?show=all"
         class="px-3 py-2 rounded-lg border {% if current == 'all' %}bg-blue-50 text-blue-700 border-blue-200{% else %}hover:bg-gray-50{% endif %}">
        Toutes
      </a>

      <form method="post" action="{% url 'notifications:read_all' %}">
        {% csrf_token %}
        <button class="px-3 py-2 rounded-lg bg-gray-900 text-white hover:bg-gray-800">
          Tout marquer comme lu
        </button>
      </form>
    </div>
  </header>

  {% if page_obj and page_obj.object_list %}
    <ul class="bg-white rounded-xl shadow divide-y">
      {% for n in page_obj.object_list %}
        <li class="p-4 flex items-start gap-3 {% if not n.is_read %}bg-blue-50/40{% endif %}">
          <!-- Pastille niveau -->
          <span class="mt-1 w-2.5 h-2.5 rounded-full
                       {% if n.level == 'success' %}bg-emerald-500
                       {% elif n.level == 'warning' %}bg-amber-500
                       {% elif n.level == 'error' %}bg-red-500
                       {% else %}bg-blue-500{% endif %}">
          </span>

          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between gap-3">
              <h3 class="font-semibold text-gray-900 truncate">{{ n.title }}</h3>
              <time class="shrink-0 text-xs text-gray-500">{{ n.created_at|date:"d/m/Y H:i" }}</time>
            </div>

            {% if n.message %}
              <p class="mt-1 text-sm text-gray-700">{{ n.message }}</p>
            {% endif %}

            <div class="mt-2 flex items-center gap-3">
              {% if n.url %}
                <a href="{{ n.url }}" class="text-blue-600 text-sm hover:underline">Voir</a>
              {% elif n.get_absolute_url %}
                <a href="{{ n.get_absolute_url }}" class="text-blue-600 text-sm hover:underline">Ouvrir</a>
              {% endif %}

              {% if not n.is_read %}
                <form method="post" action="{% url 'notifications:open' pk=item.id %}" class="inline">
                  {% csrf_token %}
                  <button class="text-sm text-gray-600 hover:underline">Marquer comme lu</button>
                </form>
              {% else %}
                <span class="text-xs text-gray-500">Lu</span>
              {% endif %}
            </div>
          </div>
        </li>
      {% endfor %}
    </ul>

    <!-- Pagination -->
    <div class="mt-6 flex items-center justify-between">
      <div class="text-sm text-gray-600">
        Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </div>
      <div class="flex gap-2">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&show={{ current }}" class="px-3 py-2 rounded border hover:bg-gray-50">Précédent</a>
        {% else %}
          <span class="px-3 py-2 rounded border text-gray-400">Précédent</span>
        {% endif %}
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}&show={{ current }}" class="px-3 py-2 rounded border hover:bg-gray-50">Suivant</a>
        {% else %}
          <span class="px-3 py-2 rounded border text-gray-400">Suivant</span>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="text-center py-16">
      <img src="{% static 'img/empty-state.svg' %}" class="mx-auto w-40 h-40 opacity-70" alt="">
      <h3 class="mt-4 text-lg font-semibold text-gray-900">Aucune notification</h3>
      <p class="text-gray-600">Nous vous préviendrons ici lorsqu’il y aura du nouveau.</p>
    </div>
  {% endif %}
  {% endwith %}
</section>
{% endblock %}
