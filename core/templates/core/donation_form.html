{% extends "base.html" %}
{% load static i18n widget_tweaks %}
{% block title %}Don — BAMU WELLBEING Foundation{% endblock %}

{% block content %}
<section class="mx-auto max-w-5xl px-4 pb-12">
  <header class="mb-8 text-center md:text-left">
    <h1 class="text-3xl font-extrabold text-blue-700 dark:text-blue-300">{% trans "Faire un don" %}</h1>
    <p class="mt-2 text-slate-600 dark:text-slate-300">
      {% blocktrans %}Choisissez le mode de paiement qui vous convient pour soutenir nos actions en RDC et à l’international.{% endblocktrans %}
    </p>
  </header>

  {% include "partials/messages.html" %}

  <div class="grid gap-8 lg:grid-cols-2">
    <article class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm dark:border-white/10 dark:bg-slate-900">
      <header class="mb-4">
        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Carte bancaire (USD)</h2>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
          {% blocktrans %}Paiement sécurisé via Flutterwave — Visa, Mastercard, Mobile Money international.{% endblocktrans %}
        </p>
      </header>

      <form method="post" action="" enctype="multipart/form-data" class="space-y-5" novalidate>
        {% csrf_token %}
        <input type="hidden" name="currency" value="USD">
        <input type="hidden" name="method" value="card">

        {% if form.non_field_errors %}
          <div class="rounded-lg border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-700 dark:border-rose-900/40 dark:bg-rose-900/20 dark:text-rose-200">
            {{ form.non_field_errors }}
          </div>
        {% endif %}

        <div>
          <label for="{{ form.amount.id_for_label }}" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Montant (USD)" %}</label>
          {% render_field form.amount class+="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40" data-quick-input="card" inputmode="decimal" %}
          {% if form.amount.errors %}
            <p class="mt-1 text-xs text-rose-600">{{ form.amount.errors.0 }}</p>
          {% endif %}

          <div class="mt-3 flex flex-wrap gap-2" id="quick-amounts-card">
            {% for val in quick_amounts %}
              <button type="button" data-quick-target="card" data-quick-amount="{{ val }}"
                      class="rounded-lg border border-slate-200 bg-slate-100 px-3 py-1.5 text-sm font-medium text-slate-700 transition hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 dark:border-white/10 dark:bg-slate-800 dark:text-slate-200 dark:hover:bg-slate-700">
                {{ val }}
              </button>
            {% endfor %}
          </div>
        </div>

        <div>
          <label for="{{ form.donor_name.id_for_label }}" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Nom (optionnel)" %}</label>
          {% render_field form.donor_name class+="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40" autocomplete="name" %}
          {% if form.donor_name.errors %}
            <p class="mt-1 text-xs text-rose-600">{{ form.donor_name.errors.0 }}</p>
          {% endif %}
        </div>

        <div>
          <label for="{{ form.message.id_for_label }}" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Message (optionnel)" %}</label>
          {% render_field form.message class+="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40" rows="4" %}
          {% if form.message.errors %}
            <p class="mt-1 text-xs text-rose-600">{{ form.message.errors.0 }}</p>
          {% endif %}
        </div>

        <footer class="space-y-2 text-sm text-slate-600 dark:text-slate-300">
          <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">{% trans "Sécurisé par Flutterwave" %}</p>
          {% if PAYMENT_MAINTENANCE %}
            <button type="button" class="flex w-full items-center justify-center rounded-xl border border-slate-300 bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 shadow-sm dark:border-slate-600 dark:bg-slate-800 dark:text-slate-300" disabled>
              {% trans "Paiement indisponible (maintenance)" %}
            </button>
          {% else %}
            <button type="submit" class="flex w-full items-center justify-center gap-2 rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-blue-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus-visible:ring-blue-400/60">
              {% trans "Payer" %}
            </button>
          {% endif %}
        </footer>
      </form>
    </article>

    <article class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm dark:border-white/10 dark:bg-slate-900">
      <header class="mb-4">
        <h2 class="text-xl font-bold text-slate-900 dark:text-white">Mobile Money RDC (CDF)</h2>
        <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">
          {% blocktrans %}Paiement local via CinetPay — Airtel Money, M-Pesa, Orange Money, cartes locales.{% endblocktrans %}
        </p>
      </header>

      <form method="post" action="{% url 'payments:rdc_start' %}" class="space-y-5" novalidate>
        {% csrf_token %}
        <div>
          <label for="don-mobile-amount" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Montant (CDF)" %}</label>
          <input id="don-mobile-amount" name="amount" type="number" min="1000" step="50"
                 class="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40"
                 data-quick-input="mm" required>
          <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">{% trans "Montant minimum recommandé : 1 000 CDF." %}</p>
          <div class="mt-3 flex flex-wrap gap-2" id="quick-amounts-mm">
            {% for val in "5000,10000,20000,50000".split(",") %}
              <button type="button" data-quick-target="mm" data-quick-amount="{{ val }}"
                      class="rounded-lg border border-slate-200 bg-slate-100 px-3 py-1.5 text-sm font-medium text-slate-700 transition hover:bg-slate-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 dark:border-white/10 dark:bg-slate-800 dark:text-slate-200 dark:hover:bg-slate-700">
                {{ val }}
              </button>
            {% endfor %}
          </div>
        </div>

        <div>
          <label for="don-mobile-name" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Nom" %}</label>
          <input id="don-mobile-name" name="name" type="text" autocomplete="name"
                 class="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40">
        </div>

        <div>
          <label for="don-mobile-email" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">Email</label>
          <input id="don-mobile-email" name="email" type="email" autocomplete="email"
                 class="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40">
          <p class="mt-1 text-xs text-slate-500 dark:text-slate-400">{% trans "Permet de vous envoyer un reçu." %}</p>
        </div>

        <div>
          <label for="don-mobile-phone" class="mb-1 block text-sm font-semibold text-slate-800 dark:text-slate-100">{% trans "Téléphone Mobile Money" %}</label>
          <input id="don-mobile-phone" name="phone_e164" type="tel" inputmode="tel" autocomplete="tel"
                 class="w-full rounded-xl border border-slate-300 bg-white/90 px-3 py-2 text-base text-slate-900 shadow-sm outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-100 dark:border-white/10 dark:bg-slate-950 dark:text-slate-100 dark:focus:ring-blue-500/40"
                 placeholder="ex : +243xxxxxxxxx">
        </div>

        <footer class="space-y-2 text-sm text-slate-600 dark:text-slate-300">
          <p class="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">{% trans "Sécurisé par CinetPay" %}</p>
          <button type="submit" class="flex w-full items-center justify-center gap-2 rounded-xl bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-emerald-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600/60 dark:bg-emerald-500 dark:hover:bg-emerald-600 dark:focus-visible:ring-emerald-400/60">
            {% trans "Continuer vers Mobile Money" %}
          </button>
        </footer>
      </form>
    </article>
  </div>

  <article class="mt-10 rounded-2xl border border-slate-200 bg-slate-50 p-6 text-sm text-slate-700 dark:border-white/10 dark:bg-slate-900/40 dark:text-slate-200">
    <h2 class="text-lg font-semibold text-slate-900 dark:text-white">{% trans "Autres moyens de soutien" %}</h2>
    <ul class="mt-3 space-y-2">
      <li>{% trans "Virement bancaire : contactez-nous pour recevoir les coordonnées complètes." %}</li>
      <li>{% trans "Don en nature ou matériel : écrivez-nous via la page contact pour organiser la collecte." %}</li>
      <li>{% trans "Besoin d’un reçu fiscal ou d’une facture ? Indiquez-le dans votre message ou par email." %}</li>
    </ul>
    <p class="mt-3 text-xs text-slate-500 dark:text-slate-400">{% trans "Notre équipe revient vers vous sous 24 h ouvrées." %}</p>
  </article>
</section>

<script>
(function(){
  document.addEventListener('DOMContentLoaded', function(){
    document.querySelectorAll('[data-quick-target]').forEach(function(btn){
      btn.addEventListener('click', function(){
        var target = btn.getAttribute('data-quick-target');
        var amount = btn.getAttribute('data-quick-amount');
        var input = document.querySelector('[data-quick-input="' + target + '"]');
        if (!input) return;
        input.value = amount;
        if (input.focus) {
          input.focus({ preventScroll: true });
        }
      });
    });
  });
})();
</script>
{% endblock %}
