{% extends "staff/base_staff.html" %}
{% block staff_title %}Staff — Heures{% endblock %}

{% block staff_content %}
<h1 class="text-2xl font-extrabold text-blue-700 dark:text-blue-300 mb-4">Heures déclarées</h1>

<form method="get" action=""
      class="bg-white dark:bg-slate-900 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 p-4 mb-4 grid grid-cols-1 md:grid-cols-4 gap-3">
  <input type="search" name="q" value="{{ request.GET.q|default_if_none:'' }}" placeholder="Bénévole, mission, note…"
         class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10
                bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100 placeholder-slate-400
                focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
  <input type="date" name="from" value="{{ request.GET.from }}"
         class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10
                bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100
                focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
  <input type="date" name="to" value="{{ request.GET.to }}"
         class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10
                bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100
                focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
  <select name="has_proofs"
          class="w-full px-3 py-2 rounded-lg border border-slate-300 dark:border-white/10
                 bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100
                 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20">
    <option value="">Pièces jointes ?</option>
    <option value="yes" {% if request.GET.has_proofs == 'yes' %}selected{% endif %}>Oui</option>
    <option value="no"  {% if request.GET.has_proofs == 'no' %}selected{% endif %}>Non</option>
  </select>

  <div class="md:col-span-4">
    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700
                   focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-600/60">
      Filtrer
    </button>
    {% if request.GET %}
      <a href="{{ request.path }}" class="ml-2 text-sm text-slate-600 dark:text-slate-400 hover:underline">Réinitialiser</a>
    {% endif %}
  </div>
</form>

<section class="bg-white dark:bg-slate-900 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 overflow-hidden">
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead class="bg-gray-50 dark:bg-slate-800/60 text-slate-700 dark:text-slate-200">
        <tr class="text-left">
          <th class="p-3">Date</th>
          <th class="p-3">Bénévole</th>
          <th class="p-3">Mission/Événement</th>
          <th class="p-3">Heures</th>
          <th class="p-3">Note</th>
          <th class="p-3">Pièces</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-200 dark:divide-white/10">
        {% for e in page_obj.object_list %}
        <tr>
          <td class="p-3 text-slate-900 dark:text-slate-100">{{ e.date|date:"d/m/Y" }}</td>
          <td class="p-3 text-slate-900 dark:text-slate-100">{{ e.volunteer_name }}</td>
          <td class="p-3">
            {% if e.mission_title %}
              <div class="text-slate-900 dark:text-slate-100">Mission : <span class="font-medium">{{ e.mission_title }}</span></div>
            {% endif %}
            {% if e.event_title %}
              <div class="text-slate-900 dark:text-slate-100">Événement : <span class="font-medium">{{ e.event_title }}</span></div>
            {% endif %}
          </td>
          <td class="p-3 text-slate-900 dark:text-slate-100">{{ e.hours }}</td>
          <td class="p-3 text-slate-600 dark:text-slate-300">{{ e.note|default:"—" }}</td>
          <td class="p-3">
            {% if e.proofs %}
              <ul class="text-xs space-y-1">
                {% for p in e.proofs %}
                  <li>
                    <a href="{{ p.url }}" target="_blank" class="text-blue-600 dark:text-blue-300 underline">{{ p.name }}</a>
                    <span class="text-slate-500 dark:text-slate-400">({{ p.size }} o)</span>
                  </li>
                {% endfor %}
              </ul>
            {% else %}<span class="text-slate-600 dark:text-slate-300">—</span>{% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="6" class="p-6 text-center text-slate-500 dark:text-slate-400">Aucune déclaration.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

{% include "staff/partials/_pagination.html" with page_obj=page_obj %}
{% endblock %}
