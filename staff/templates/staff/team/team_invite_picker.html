{% extends "staff/base_staff.html" %}
{% block staff_title %}Staff — Inviter des bénévoles{% endblock %}

{% block staff_content %}
<header class="mb-4 flex items-center justify-between">
  <h1 class="text-2xl font-extrabold text-blue-700 dark:text-blue-300">Inviter des bénévoles</h1>
  <a href="{% url 'staff:team_list' %}"
     class="px-3 py-2 rounded-lg ring-1 ring-slate-200 hover:bg-slate-50 dark:ring-white/10 dark:hover:bg-white/5">← Retour à l’équipe</a>
</header>

<form method="get"
      class="bg-white dark:bg-slate-900 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 p-4 mb-4 grid grid-cols-1 md:grid-cols-4 gap-3">
  {{ form.q }}
  {{ form.skill }}
  {{ form.day }}
  {{ form.slot }}
  <label class="flex items-center gap-2 text-sm md:col-span-4">
    {{ form.only_available }} Masquer les bénévoles déjà invités / déjà dans l’équipe
  </label>
  <div class="md:col-span-4">
    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Filtrer</button>
    {% if request.GET %}
      <a href="{{ request.path }}" class="ml-2 text-sm text-slate-600 dark:text-slate-400 hover:underline">Réinitialiser</a>
    {% endif %}
  </div>
</form>

<form method="post" class="js-auth-managed bg-white dark:bg-slate-900 rounded-2xl shadow ring-1 ring-black/5 dark:ring-white/10 overflow-hidden"
      data-auth-message="Clé requise pour envoyer des invitations."
      data-superuser="{{ request.user.is_superuser|yesno:'true,false' }}">
  {% csrf_token %}
  <table class="w-full text-sm">
    <thead class="bg-gray-50 dark:bg-slate-800/60">
      <tr class="text-left text-slate-700 dark:text-slate-200">
        <th class="p-3 w-8"><input type="checkbox" id="checkAll" class="h-4 w-4"></th>
        <th class="p-3">Nom</th>
        <th class="p-3">Email</th>
        <th class="p-3">Téléphone</th>
        <th class="p-3 text-right">Action</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-200 dark:divide-white/10">
      {% for v in page_obj.object_list %}
      <tr>
        <td class="p-3"><input type="checkbox" name="volunteer_ids" value="{{ v.id }}" class="h-4 w-4"></td>
        <td class="p-3 font-medium">{{ v.display_name|default:v.name|default:v.user.get_username }}</td>
        <td class="p-3">{{ v.email|default:v.user.email|default:"—" }}</td>
        <td class="p-3">{{ v.phone|default:"—" }}</td>
        <td class="p-3 text-right">
          <form method="post" action="{% url 'staff:volunteer_team_invite' volunteer_id=v.id %}" class="inline js-auth-managed"
                data-auth-message="Clé requise pour inviter ce bénévole."
                data-superuser="{{ request.user.is_superuser|yesno:'true,false' }}"
                >
            {% csrf_token %}
            <button class="px-2 py-1 rounded bg-blue-600 text-white text-xs hover:bg-blue-700">Inviter</button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="5" class="p-6 text-center text-slate-500 dark:text-slate-400">Aucun bénévole à proposer.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="flex items-center justify-between p-3">
    <div class="text-xs text-slate-500">Sélectionnez plusieurs bénévoles pour un envoi groupé.</div>
    <button type="submit" class="px-3 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700">Envoyer les invitations sélectionnées</button>
  </div>
</form>

{% include "staff/partials/_pagination.html" with page_obj=page_obj %}
<script>
  document.getElementById('checkAll')?.addEventListener('change', (e)=>{
    document.querySelectorAll('input[name="volunteer_ids"]').forEach(cb=> cb.checked = e.target.checked);
  });
</script>
{% endblock %}
